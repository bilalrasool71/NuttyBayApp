<div class="p-6">
    <div *ngIf="productionId && productionRunData">
        <div class="border border-gray-300 rounded-lg p-3 shadow-[0_2px_10px_-4px_rgba(93,96,127,0.2)]">
            <div class="grid xl:grid-cols-2 lg:grid-cols-2 md:grid-cols-2 grid-cols-1">
                <h4 class="font-bold float-right">Producion Run&nbsp;(<span *ngFor="let product of productionRunData.products; let j = index">
                        {{product.productName}} {{ j === productionRunData.products.length - 1 ? '' : '|' }}
                    </span>)</h4>
                <h4 class="md:text-right lg:text-right text-left font-bold">Start Time:&nbsp;<span class="font-normal">{{ productionRunData.productionDate |
                        date:'dd-MM-yyyy | hh:mm a' }}</span></h4>
            </div>
        </div>
    </div>
    <p-divider *ngIf="productionRunData" type="dotted" styleClass="!p-0 !m-0 space-y-0 gap-0">
        <div class="font-bold">
            {{currentValue == 1 ? 'Pre Making' : currentValue === 2 ? 'Making' : currentValue === 3 ? 'Pre Packing' : currentValue === 4 ? 'Packing' : ''}}
        </div>
    </p-divider>
    <p-stepper [value]="currentValue" (valueChange)="ngStepChange($event)">
        <p-step-panels>
            <p-step-panel *ngFor="let checklist of allChecklists" [value]="checklist.checklistId">
                <ng-container *ngIf="checklist.checklistType === 1">
                    <ng-template #content let-activateCallback="activateCallback">
                        <ng-container *ngIf="productionRunData && productionRunData.sharedChecklists && productionRunData.sharedChecklists.length>0">
                            <ng-container *ngFor="let obj of productionRunData.sharedChecklists">
                                <ng-container *ngIf="obj.checklistId == checklist.checklistId">
                                    <div class="border border-gray-300 rounded-lg p-3 shadow-[0_2px_22px_-4px_rgba(93,96,127,0.2)]">
                                        <p-table [value]="obj.tasks">
                                            <ng-template #header>
                                                <tr>
                                                    <th class="!pl-0">Task to perform</th>
                                                </tr>
                                            </ng-template>
                                            <ng-template #body let-task>
                                                <tr>
                                                    <td class="flex items-center gap-2">
                                                        <p-checkbox class="!align-top" (onChange)="onChange(task, obj.checklistId)" [(ngModel)]="task.isCompleted" [binary]="true"></p-checkbox>
                                                        <div class="text-xs text-gray-600">
                                                            {{task.taskDescription}}
                                                        </div>
                                                    </td>
                                                </tr>
                                            </ng-template>
                                        </p-table>
                                    </div>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                        <div class="flex justify-end items-center gap-2 mt-6">
                            <p-button label="Back" severity="warn" *ngIf="checklist.checklistOrder > 1" (onClick)="activateCallback(checklist.checklistOrder - 1)"></p-button>
                            <p-button label="Save & Continue" *ngIf="checklist.checklistOrder < 3" (onClick)="activateCallback(checklist.checklistId+1)"></p-button>
                            <p-button severity="contrast" (onClick)="goToExit()" label="Save & Exit" *ngIf="checklist.checklistOrder < 3" (onClick)="activateCallback(checklist.checklistId+1)"></p-button>
                            <p-button label="Save & Complete" (onClick)="goToExit()" *ngIf="checklist.checklistOrder > 3" (onClick)="null"></p-button>
                        </div>
                    </ng-template>
                </ng-container>
                <ng-container *ngIf="checklist.checklistType === 2">
                    <ng-template #content let-activateCallback="activateCallback">
                        <div class="grid grid-cols-1 gap-2 p-2">
                            <ng-container *ngFor="let preObj of productionRunData.prePackingList; let i = index">
                                <div class="border border-gray-300 rounded-lg p-3 shadow-[0_2px_22px_-4px_rgba(93,96,127,0.2)]">
                                        <div class="flex items-center justify-between mb-3">
                                            <h3 class="text-xl font-bold">{{preObj.productName}}</h3>
                                            <p-button label="Save" (onClick)="onSavePrePacking(preObj)" [disabled]="!preObj.prePackingData.temperature || !preObj.prePackingData.ph || !preObj.prePackingData.time" />

                                        </div>
                                    <div class="border-2 border-dashed border-gray-400 p-4 rounded">
                                        <div class="grid grid-cols-1 gap-3">
                                            <p-floatlabel variant="on">
                                                <p-input-number type="number" [id]="'temperature'+i" [(ngModel)]="preObj.prePackingData.temperature" [min]="0" [max]="99" [step]="1" [mode]="'decimal'" [useGrouping]="false" [maxFractionDigits]="0" (onInput)="validateTemperature(preObj.prePackingData, $event)"/>
                                                <label [attr.for]="'temperature'+i">Temperature</label>
                                            </p-floatlabel>
                                            <p-floatlabel variant="on">
                                                <p-input-number [id]="'ph'+i" [(ngModel)]="preObj.prePackingData.ph" [min]="0" [max]="14" [step]="0.1" [mode]="'decimal'" [useGrouping]="false" [maxFractionDigits]="1" (onInput)="validatePH(preObj.prePackingData, $event)" />
                                                <label [attr.for]="'ph'+ i">PH</label>
                                            </p-floatlabel>
                                            <p-floatlabel variant="on">
                                                <p-datepicker [showIcon]="true" icon="pi pi-clock" [id]="'ph'+i" [(ngModel)]="preObj.prePackingData.time" [showTime]="true" hourFormat="12"></p-datepicker>
                                                <label [attr.for]="'time'+i">Time</label>
                                            </p-floatlabel>
                                        </div>
                                    </div>
                                </div>
                            </ng-container>
                            <div class="flex justify-end items-center gap-2 mt-6">
                                <p-button label="Back" severity="warn" (onClick)="activateCallback(2)"></p-button>
                                <p-button label="Save & Continue" (onClick)="activateCallback(4)"></p-button>
                                <p-button severity="contrast" (onClick)="goToExit()" label="Save & Exit"></p-button>
                            </div>
                        </div>
                    </ng-template>
                </ng-container>
            </p-step-panel>
        </p-step-panels>
    </p-stepper>
</div>